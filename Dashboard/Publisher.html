<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Publisher Dashboard — Manage Books</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root{
            --brand:#5b6ff0;
            --muted:#6c757d;
            --card:#ffffff;
            --bg:#f5f7ff;
        }
        body{ background:var(--bg); min-height:100vh; }
        .sidebar{
            background:linear-gradient(180deg,var(--brand),#3f54d1);
            color:white;
            min-height:100vh;
        }
        .sidebar a{ color:rgba(255,255,255,0.9); text-decoration:none; }
        .brand {
            font-weight:700; letter-spacing:0.2px;
        }
        .cover-img{
            width:56px; height:76px; object-fit:cover; border-radius:6px;
            box-shadow:0 6px 20px rgba(11,24,60,0.06);
        }
        .table thead th { border-bottom:0; }
        .badge-status { font-size:0.75rem; }
        @media (max-width:991px){
            .sidebar { position:fixed; z-index:1030; transform:translateX(-110%); transition:transform .25s; }
            .sidebar.show { transform:translateX(0%); }
            .content-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.25); z-index:1020; display:none; }
            .content-overlay.show{ display:block; }
        }
    </style>
</head>
<body>

<div class="d-flex">
    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar p-3 d-none d-lg-block" style="width:260px;">
        <div class="mb-4 d-flex align-items-center gap-2">
            <div class="bg-white text-dark rounded-3 p-2" style="width:44px;height:44px;display:flex;align-items:center;justify-content:center;">
                <i class="bi bi-book-half" style="color:var(--brand);font-size:1.25rem"></i>
            </div>
            <div>
                <div class="brand">Intelli-Read</div>
                <div class="small" style="opacity:.9">Publisher Dashboard</div>
            </div>
        </div>

        <div class="mb-3">
            <a href="#" class="d-flex align-items-center gap-2 p-2 rounded-3" onclick="navSelect(this)">
                <i class="bi bi-layout-text-sidebar-reverse"></i> Dashboard
            </a>
            <a href="#" class="d-flex align-items-center gap-2 p-2 rounded-3" onclick="navSelect(this)">
                <i class="bi bi-journal-bookmark"></i> Books
            </a>
            <a href="#" class="d-flex align-items-center gap-2 p-2 rounded-3" onclick="navSelect(this)">
                <i class="bi bi-gear"></i> Settings
            </a>
        </div>

        <hr style="border-color:rgba(255,255,255,.08)">

        <div class="mt-3">
            <div class="small mb-2 text-white-50">Quick Actions</div>
            <button class="btn btn-light btn-sm w-100 mb-2" onclick="openAddModal()">
                <i class="bi bi-plus-lg"></i> Add New Book
            </button>
            <button class="btn btn-outline-light btn-sm w-100" onclick="clearAllDemo()">
                <i class="bi bi-trash"></i> Clear Demo Data
            </button>
        </div>

        <div class="mt-4 small text-white-50">
            <div>Plan: <strong>Publisher Pro</strong></div>
            <div class="mt-2">Books: <strong id="countBooks">0</strong></div>
        </div>

    </nav>

    <!-- Content -->
    <div class="flex-fill">
        <!-- Topbar -->
        <nav class="navbar navbar-light bg-white shadow-sm px-3 d-flex d-lg-none">
            <button class="btn btn-outline-primary btn-sm me-2" id="toggleSidebarBtn">
                <i class="bi bi-list"></i>
            </button>
            <span class="navbar-brand mb-0">Intelli-Read — Publisher</span>
        </nav>

        <div id="contentOverlay" class="content-overlay"></div>

        <main class="container-fluid py-4 px-3 px-lg-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h4 class="mb-0">Books Management</h4>
                    <div class="small text-muted">Create, update and organize your book catalog</div>
                </div>
                <div class="d-flex gap-2">
                    <div class="input-group">
                        <input id="searchInput" class="form-control form-control-sm" placeholder="Search by title, author or genre" oninput="renderBooks()" />
                        <button class="btn btn-primary btn-sm" onclick="openAddModal()"><i class="bi bi-plus-lg"></i> Add book</button>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="row g-3 mb-4">
                <div class="col-sm-6 col-lg-3">
                    <div class="card p-3">
                        <div class="small text-muted">Total Books</div>
                        <div class="h4 mb-0" id="statTotal">0</div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="card p-3">
                        <div class="small text-muted">Published</div>
                        <div class="h4 mb-0" id="statPublished">0</div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="card p-3">
                        <div class="small text-muted">Drafts</div>
                        <div class="h4 mb-0" id="statDrafts">0</div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="card p-3">
                        <div class="small text-muted">Authors</div>
                        <div class="h4 mb-0" id="statAuthors">0</div>
                    </div>
                </div>
            </div>

            <!-- Table / List -->
            <div class="card shadow-sm mb-4">
                <div class="card-body p-3">
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th></th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Genre</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="booksTableBody">
                                <!-- Rows inserted by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Empty / hint -->
            <div id="emptyHint" class="text-center text-muted py-5" style="display:none">
                <i class="bi bi-journal-plus" style="font-size:40px"></i>
                <div class="mt-3">No books yet. Click "Add book" to create your first title.</div>
            </div>

            <footer class="small text-muted mt-5 mb-4">
                © Intelli-Read — Publisher Dashboard
            </footer>
        </main>
    </div>
</div>

<!-- Add / Edit Modal -->
<div class="modal fade" id="bookModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <form id="bookForm" class="modal-content" onsubmit="submitBookForm(event)">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Add Book</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal()"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="bookId" />
                <div class="row g-3">
                    <div class="col-md-4 text-center">
                        <label class="small text-muted">Cover</label>
                        <div class="border rounded-3 p-2">
                            <img id="coverPreview" class="cover-img mb-2" src="" alt="cover" />
                            <div class="mb-2">
                                <input id="coverInput" type="file" accept="image/*" class="form-control form-control-sm" onchange="handleCoverChange(event)" />
                            </div>
                            <div class="small text-muted">Square or vertical images work best.</div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="mb-2">
                            <label class="form-label small">Title</label>
                            <input id="title" class="form-control form-control-sm" required />
                        </div>

                        <div class="row g-2">
                            <div class="col-md-6">
                                <label class="form-label small">Author</label>
                                <input id="author" class="form-control form-control-sm" required />
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small">Genre</label>
                                <input id="genre" class="form-control form-control-sm" />
                            </div>
                            <div class="col-md-3">
                                <label class="form-label small">Price</label>
                                <input id="price" type="number" step="0.01" min="0" class="form-control form-control-sm" />
                            </div>
                        </div>

                        <div class="row g-2 mt-2">
                            <div class="col-md-4">
                                <label class="form-label small">Stock</label>
                                <input id="stock" type="number" min="0" class="form-control form-control-sm" />
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Status</label>
                                <select id="status" class="form-select form-select-sm">
                                    <option value="published">Published</option>
                                    <option value="draft">Draft</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Language</label>
                                <input id="language" class="form-control form-control-sm" />
                            </div>
                        </div>

                        <div class="mt-3">
                            <label class="form-label small">Description</label>
                            <textarea id="description" rows="3" class="form-control form-control-sm"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary btn-sm">Save Book</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete confirmation modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="text-center py-3">
                    <i class="bi bi-exclamation-triangle text-warning" style="font-size:30px"></i>
                    <h5 class="mt-2">Delete this book?</h5>
                    <div class="small text-muted">This action cannot be undone.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="delCancel" type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button id="delConfirm" type="button" class="btn btn-danger btn-sm">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS + optional dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Simple client-side book management with localStorage persistence.
    const LS_KEY = 'publisher_books_v1';

    // UI references
    const booksTableBody = document.getElementById('booksTableBody');
    const searchInput = document.getElementById('searchInput');
    const statTotal = document.getElementById('statTotal');
    const statPublished = document.getElementById('statPublished');
    const statDrafts = document.getElementById('statDrafts');
    const statAuthors = document.getElementById('statAuthors');
    const countBooks = document.getElementById('countBooks');
    const emptyHint = document.getElementById('emptyHint');

    const bookModalEl = document.getElementById('bookModal');
    const bookModal = new bootstrap.Modal(bookModalEl, { backdrop: 'static', keyboard: true });
    const confirmDeleteModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));

    // Sidebar toggle (mobile)
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
    const contentOverlay = document.getElementById('contentOverlay');
    if(toggleSidebarBtn){
        toggleSidebarBtn.addEventListener('click', () => {
            sidebar.classList.toggle('show');
            contentOverlay.classList.toggle('show');
        });
        contentOverlay.addEventListener('click', () => {
            sidebar.classList.remove('show');
            contentOverlay.classList.remove('show');
        });
    }

    // Helpers
    function uid() { return Math.random().toString(36).slice(2, 9); }

    function loadBooks(){
        try {
            const raw = localStorage.getItem(LS_KEY);
            if(!raw) return seedDemo();
            return JSON.parse(raw);
        } catch(e){ return seedDemo(); }
    }

    function saveBooks(list){
        localStorage.setItem(LS_KEY, JSON.stringify(list));
    }

    function seedDemo(){
        // Demo data if none exists
        const demo = [
            { id: uid(), title: 'The Quantum Garden', author: 'A. R. Finch', genre: 'Science Fiction', price: 9.99, stock: 120, status: 'published', language:'English', description: 'A speculative journey.', cover: '', createdAt: Date.now() - 86400000 },
            { id: uid(), title: 'Modern CSS Layouts', author: 'J. Lee', genre: 'Education', price: 14.5, stock: 50, status: 'draft', language:'English', description: 'Practical techniques for responsive design.', cover: '', createdAt: Date.now() - 3600000 },
            { id: uid(), title: 'Culinary Travel', author: 'M. Ortega', genre: 'Travel', price: 12.00, stock: 30, status: 'published', language:'Spanish', description: 'Tasting the world one city at a time.', cover: '', createdAt: Date.now() - 7200000 }
        ];
        saveBooks(demo);
        return demo;
    }

    // State
    let books = loadBooks();

    // Render functions
    function renderBooks(){
        const q = (searchInput.value || '').trim().toLowerCase();
        const filtered = books.filter(b => {
            if(!q) return true;
            return (b.title || '').toLowerCase().includes(q) ||
                         (b.author || '').toLowerCase().includes(q) ||
                         (b.genre || '').toLowerCase().includes(q);
        }).sort((a,b)=> b.createdAt - a.createdAt);

        booksTableBody.innerHTML = '';
        if(filtered.length === 0){
            emptyHint.style.display = books.length ? 'none' : 'block';
        } else {
            emptyHint.style.display = 'none';
        }

        for(const b of filtered){
            const tr = document.createElement('tr');

            const coverTd = document.createElement('td');
            const img = document.createElement('img');
            img.src = b.cover || placeholderDataUrl(b.title || b.author);
            img.alt = b.title || 'cover';
            img.className = 'cover-img';
            coverTd.appendChild(img);

            const titleTd = document.createElement('td');
            titleTd.innerHTML = '<div class="fw-semibold">'+escapeHtml(b.title || 'Untitled')+'</div><div class="small text-muted">'+escapeHtml(b.description || '')+'</div>';

            const authorTd = document.createElement('td');
            authorTd.textContent = b.author || '';

            const genreTd = document.createElement('td');
            genreTd.textContent = b.genre || '';

            const priceTd = document.createElement('td');
            priceTd.textContent = (b.price != null && b.price !== '') ? ('$' + Number(b.price).toFixed(2)) : '-';

            const stockTd = document.createElement('td');
            stockTd.textContent = (b.stock != null) ? b.stock : '-';

            const statusTd = document.createElement('td');
            const badge = document.createElement('span');
            badge.className = 'badge badge-status ' + (b.status === 'published' ? 'bg-success' : 'bg-secondary');
            badge.textContent = b.status === 'published' ? 'Published' : 'Draft';
            statusTd.appendChild(badge);

            const actionsTd = document.createElement('td');
            actionsTd.className = 'text-end';
            actionsTd.innerHTML = `
                <div class="d-inline-flex gap-1">
                    <button class="btn btn-sm btn-outline-primary" title="Edit" onclick="openEditModal('${b.id}')"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-sm btn-outline-danger" title="Delete" onclick="requestDelete('${b.id}')"><i class="bi bi-trash"></i></button>
                    <button class="btn btn-sm btn-outline-secondary" title="Toggle status" onclick="togglePublishStatus('${b.id}')"><i class="bi bi-toggle2-${b.status === 'published' ? 'on' : 'off'}"></i></button>
                </div>
            `;

            tr.appendChild(coverTd);
            tr.appendChild(titleTd);
            tr.appendChild(authorTd);
            tr.appendChild(genreTd);
            tr.appendChild(priceTd);
            tr.appendChild(stockTd);
            tr.appendChild(statusTd);
            tr.appendChild(actionsTd);

            booksTableBody.appendChild(tr);
        }

        updateStats();
    }

    function updateStats(){
        statTotal.textContent = books.length;
        statPublished.textContent = books.filter(b => b.status === 'published').length;
        statDrafts.textContent = books.filter(b => b.status === 'draft').length;
        const authors = new Set(books.map(b => (b.author||'').trim()).filter(Boolean));
        statAuthors.textContent = authors.size;
        countBooks.textContent = books.length;
    }

    // CRUD operations
    function openAddModal(){
        document.getElementById('modalTitle').textContent = 'Add Book';
        clearForm();
        bookModal.show();
    }

    function openEditModal(id){
        const b = books.find(x => x.id === id);
        if(!b) return;
        document.getElementById('modalTitle').textContent = 'Edit Book';
        fillForm(b);
        bookModal.show();
    }

    function fillForm(b){
        document.getElementById('bookId').value = b.id;
        document.getElementById('title').value = b.title || '';
        document.getElementById('author').value = b.author || '';
        document.getElementById('genre').value = b.genre || '';
        document.getElementById('price').value = b.price != null ? b.price : '';
        document.getElementById('stock').value = b.stock != null ? b.stock : '';
        document.getElementById('status').value = b.status || 'draft';
        document.getElementById('language').value = b.language || '';
        document.getElementById('description').value = b.description || '';
        document.getElementById('coverPreview').src = b.cover || placeholderDataUrl(b.title || b.author);
    }

    function clearForm(){
        document.getElementById('bookId').value = '';
        document.getElementById('title').value = '';
        document.getElementById('author').value = '';
        document.getElementById('genre').value = '';
        document.getElementById('price').value = '';
        document.getElementById('stock').value = '';
        document.getElementById('status').value = 'published';
        document.getElementById('language').value = '';
        document.getElementById('description').value = '';
        document.getElementById('coverPreview').src = placeholderDataUrl('Book');
        document.getElementById('coverInput').value = '';
    }

    function submitBookForm(e){
        e.preventDefault();
        const id = document.getElementById('bookId').value;
        const payload = {
            id: id || uid(),
            title: document.getElementById('title').value.trim(),
            author: document.getElementById('author').value.trim(),
            genre: document.getElementById('genre').value.trim(),
            price: document.getElementById('price').value ? Number(document.getElementById('price').value) : '',
            stock: document.getElementById('stock').value ? Number(document.getElementById('stock').value) : 0,
            status: document.getElementById('status').value,
            language: document.getElementById('language').value.trim(),
            description: document.getElementById('description').value.trim(),
            cover: document.getElementById('coverPreview').src,
            createdAt: Date.now()
        };

        if(id){
            // update
            books = books.map(b => b.id === id ? Object.assign({}, b, payload) : b);
        } else {
            books.unshift(payload);
        }
        saveBooks(books);
        renderBooks();
        bookModal.hide();
    }

    function handleCoverChange(event){
        const file = event.target.files && event.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
            document.getElementById('coverPreview').src = reader.result;
        };
        reader.readAsDataURL(file);
    }

    let pendingDeleteId = null;
    function requestDelete(id){
        pendingDeleteId = id;
        confirmDeleteModal.show();
        document.getElementById('delConfirm').onclick = confirmDelete;
    }

    function confirmDelete(){
        if(!pendingDeleteId) return;
        books = books.filter(b => b.id !== pendingDeleteId);
        saveBooks(books);
        renderBooks();
        pendingDeleteId = null;
        confirmDeleteModal.hide();
    }

    function togglePublishStatus(id){
        books = books.map(b => {
            if(b.id !== id) return b;
            return Object.assign({}, b, { status: b.status === 'published' ? 'draft' : 'published' });
        });
        saveBooks(books);
        renderBooks();
    }

    function clearAllDemo(){
        if(!confirm('Clear all books? This cannot be undone.')) return;
        books = [];
        saveBooks(books);
        renderBooks();
    }

    // Small utilities
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; }); }

    function placeholderDataUrl(text){
        // generate a tiny SVG data URL as placeholder cover
        const t = (text || '').slice(0,16);
        const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='260'><rect width='100%' height='100%' fill='#e9eefc'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#3f54d1' font-family='sans-serif' font-weight='700' font-size='20'>${escapeHtml(t)}</text></svg>`;
        return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
    }

    // Small nav highlight helper
    function navSelect(el){
        Array.from(document.querySelectorAll('.sidebar a')).forEach(a => a.classList.remove('bg-white','text-dark'));
        el.classList.add('bg-white','text-dark');
    }

    function closeModal(){
        bookModal.hide();
    }

    // Initialize
    if(!books || !books.length) books = loadBooks();
    renderBooks();

    // Expose some functions for inline onclick usage
    window.openAddModal = openAddModal;
    window.openEditModal = openEditModal;
    window.requestDelete = requestDelete;
    window.togglePublishStatus = togglePublishStatus;
    window.clearAllDemo = clearAllDemo;
    window.navSelect = navSelect;
    window.handleCoverChange = handleCoverChange;
    window.submitBookForm = submitBookForm;
</script>
</body>
</html></div>